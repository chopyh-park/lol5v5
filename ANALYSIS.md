# 코드 검토 및 승률 균형 메모

## 현재 균형 특성
- **승률 계산**: 팀 합산 MMR 차이를 평균 티어 기반 로지스틱 스케일(400~180)로 변환하여 승률을 얻습니다. 상위 티어일수록 스케일이 낮아 동일한 MMR 차이에서 승률 기울기가 더 커지므로, 고티어 방에서 미세한 차이도 민감하게 반영됩니다.【F:matcher.py†L120-L132】【F:matcher.py†L223-L249】
- **비용 함수 가중치**: 승률 항을 12배 가중하고, 라인 편차를 200 기준 제곱·선형 조합으로 강하게 누르며, 분산 항을 0.6배 더합니다. 승률이 60%를 넘으면 비가역적으로 캡에 걸려 후보에서 제외됩니다.【F:matcher.py†L223-L249】【F:matcher.py†L380-L399】【F:matcher.py†L522-L531】
- **직관적 제약**: NOT_SAME_TEAM과 금지 매치업은 대칭 확인을 포함하여 라인 단위로 검사하며, 윤영은 Top/Jg 두 경로를 모두 탐색한 뒤 결과를 합칩니다.【F:matcher.py†L251-L286】【F:matcher.py†L330-L344】【F:matcher.py†L512-L550】
- **승률 캡**: 이번 변경으로 A 혹은 B의 승률이 60%를 넘는 후보를 사전에 버리도록 했으며, 모든 후보가 제거되는 상황에서는 원본 결과를 사용해 빈 결과를 방지합니다.【F:matcher.py†L288-L301】【F:matcher.py†L522-L531】

## 추가 개선 아이디어
- **스케일 캘리브레이션**: 실제 전적 데이터를 일부 모아 MMR 차이 대비 체감 승률 표본을 얻은 뒤 `compute_logistic_scale`의 구간(400/310/260/220/180)을 조정하면 예측 승률이 현실과 더 맞춰집니다.【F:matcher.py†L120-L132】
- **입력 확장**: CSV/CLI 입력을 받아 즉석에서 플레이어 목록을 교체하도록 하면 `PLAYERS_TEXT`를 수정하지 않고도 즉시 매칭을 돌릴 수 있습니다.【F:matcher.py†L303-L327】
- **가시화**: 캡에 걸려 제거된 후보 수와 이유(승률 한계 초과)를 로그로 남기면 매칭 실패 상황을 디버깅하기 쉬워집니다.【F:matcher.py†L288-L301】

## 이번 수정에서 확인한 문제와 조치
- **라인 편차 과소 페널티**: 기존 `term_lane`은 400 스케일 제곱에 650 초과 보너스만 줘서 Top/Jg 등 일부 라인이 ±300 이상 벌어져도 cost가 크게 오르지 않았습니다. 새 설계는 200 기준 제곱+선형 가중치를 5×/1.5×로 적용해 라인 편차가 크면 즉시 후보 순위에서 밀리도록 했습니다.【F:matcher.py†L330-L351】
- **후보 전체 저장으로 인한 성능 저하**: 10명 완전 탐색을 전부 메모리에 쌓아 시간·메모리 낭비가 컸습니다. 이제 상위 `TOP_N_RESULTS`(기본 200)만 heap으로 유지해 탐색을 마친 뒤 정렬합니다.【F:matcher.py†L315-L327】【F:matcher.py†L335-L351】
- **윤영 단일 라인 고정으로 편향**: 상태 파일에 따라 Top 또는 Jg 한쪽만 검색해 특정 회차에 따라 불리한 결과가 나왔습니다. Top/Jg 두 가지를 모두 검색한 뒤 합쳐서 상위 후보를 고릅니다.【F:matcher.py†L468-L510】
